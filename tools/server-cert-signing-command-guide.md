> ğŸ’­ å¥½çš„ï¼Œæˆ‘ç°åœ¨éœ€è¦è¯¦ç»†è§£é‡Šç”¨æˆ·æä¾›çš„è¿™ä¸ªOpenSSLå‘½ä»¤ã€‚ç”¨æˆ·ç»™å‡ºçš„å‘½ä»¤æ˜¯ï¼š
> openssl x509 -req -days 3650 -in $CERT_DIR/server.csr -CA $CERT_DIR/ca.crt -CAkey $CERT_DIR/ca.key -CAcreateserial -extfile $TOOLS_DIR/san.cnf -extensions v3_req -out $CERT_DIR/server.crt
> é¦–å…ˆï¼Œæˆ‘éœ€è¦é€ä¸ªå‚æ•°åˆ†ææ¯ä¸ªéƒ¨åˆ†çš„ä½œç”¨ï¼Œä»¥åŠæ•´ä¸ªå‘½ä»¤çš„åŠŸèƒ½ã€‚è¿™ä¸ªå‘½ä»¤çœ‹èµ·æ¥æ˜¯ç”¨æ¥ç”Ÿæˆä¸€ä¸ªç”±CAç­¾åçš„æœåŠ¡å™¨è¯ä¹¦çš„ã€‚ç”¨æˆ·å¯èƒ½åœ¨ä½¿ç”¨OpenSSLæ¥é…ç½®TLS/SSLè¯ä¹¦ï¼Œæ¯”å¦‚ä¸ºWebæœåŠ¡å™¨ç”Ÿæˆè¯ä¹¦ã€‚
> é¦–å…ˆï¼Œåˆ†è§£å‘½ä»¤çš„ç»“æ„ï¼š
> openssl x509ï¼šè¿™æ˜¯ä½¿ç”¨OpenSSLçš„x509å‘½ä»¤ï¼Œç”¨äºå¤„ç†X.509è¯ä¹¦ã€‚
> -reqï¼šè¿™ä¸ªé€‰é¡¹è¡¨æ˜è¾“å…¥æ–‡ä»¶æ˜¯ä¸€ä¸ªè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆCSRï¼‰ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªè¯ä¹¦ã€‚æ‰€ä»¥è¿™ä¸ªå‘½ä»¤ä¼šå°†CSRè½¬æ¢ä¸ºè¯ä¹¦ã€‚
> -days 3650ï¼šæŒ‡å®šè¯ä¹¦çš„æœ‰æ•ˆæœŸï¼Œè¿™é‡Œæ˜¯3650å¤©ï¼Œä¹Ÿå°±æ˜¯å¤§çº¦10å¹´ã€‚
> -in $CERT_DIR/server.csrï¼šè¾“å…¥æ–‡ä»¶æ˜¯ä½äºCERT_DIRç›®å½•ä¸‹çš„server.csræ–‡ä»¶ï¼Œå³è¯ä¹¦ç­¾åè¯·æ±‚ã€‚
> -CA $CERT_DIR/ca.crtï¼šæŒ‡å®šCAçš„è¯ä¹¦æ–‡ä»¶ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯åŒä¸€ç›®å½•ä¸‹çš„ca.crtã€‚
> -CAkey $CERT_DIR/ca.keyï¼šæŒ‡å®šCAçš„ç§é’¥æ–‡ä»¶ï¼Œç”¨äºç­¾åç”Ÿæˆçš„è¯ä¹¦ã€‚
> -CAcreateserialï¼šå¦‚æœCAçš„åºåˆ—å·æ–‡ä»¶ï¼ˆé€šå¸¸ä¸ºca.srlï¼‰ä¸å­˜åœ¨ï¼Œè¿™ä¸ªé€‰é¡¹ä¼šåˆ›å»ºå®ƒã€‚åºåˆ—å·ç”¨äºç¡®ä¿æ¯ä¸ªè¯ä¹¦æœ‰å”¯ä¸€çš„åºåˆ—å·ã€‚
> -extfile $TOOLS_DIR/san.cnfï¼šæŒ‡å®šä¸€ä¸ªåŒ…å«æ‰©å±•ä¿¡æ¯çš„é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œå¯èƒ½é…ç½®äº†ä¸»é¢˜å¤‡ç”¨åç§°ï¼ˆSANï¼‰ç­‰æ‰©å±•ã€‚
> -extensions v3_reqï¼šæŒ‡å®šåœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨çš„æ‰©å±•éƒ¨åˆ†ï¼Œè¿™é‡Œæ˜¯v3_reqï¼Œå¯èƒ½åŒ…å«å¯†é’¥ç”¨æ³•ã€æ‰©å±•å¯†é’¥ç”¨æ³•ä»¥åŠSANç­‰ä¿¡æ¯ã€‚
> -out $CERT_DIR/server.crtï¼šè¾“å‡ºçš„è¯ä¹¦æ–‡ä»¶è·¯å¾„ï¼Œå³ç”Ÿæˆçš„æœåŠ¡å™¨è¯ä¹¦å°†ä¿å­˜åœ¨è¿™é‡Œã€‚
> æ¥ä¸‹æ¥ï¼Œéœ€è¦è€ƒè™‘æ¯ä¸ªå‚æ•°çš„å…·ä½“ä½œç”¨å’Œå¯èƒ½çš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œ-extfileå’Œ-extensionså‚æ•°æ˜¯å¦æ­£ç¡®é…ç½®ï¼ŒSANä¿¡æ¯æ˜¯å¦åŒ…å«å¿…è¦çš„ä¸»æœºåæˆ–IPåœ°å€ï¼Œè¿™å¯¹äºç°ä»£æµè§ˆå™¨éªŒè¯è¯ä¹¦æ˜¯å¦æœ‰æ•ˆéå¸¸é‡è¦ã€‚
> ç”¨æˆ·å¯èƒ½åœ¨æ‰§è¡Œæ­¤å‘½ä»¤æ—¶é‡åˆ°é—®é¢˜ï¼Œæ¯”å¦‚æ‰©å±•æ–‡ä»¶è·¯å¾„é”™è¯¯ï¼Œæˆ–è€…æƒé™é—®é¢˜å¯¼è‡´æ— æ³•è¯»å–CAçš„ç§é’¥ã€‚æ­¤å¤–ï¼Œéœ€è¦ç¡®è®¤CAçš„è¯ä¹¦å’Œç§é’¥æ˜¯å¦åŒ¹é…ï¼Œå¦åˆ™ç­¾åä¼šå¤±è´¥ã€‚
> å¦å¤–ï¼Œ-dayså‚æ•°è®¾ç½®çš„æ—¶é—´è¾ƒé•¿ï¼Œè™½ç„¶æ–¹ä¾¿ï¼Œä½†å¯èƒ½ä¸ç¬¦åˆæŸäº›å®‰å…¨ç­–ç•¥ï¼Œå»ºè®®æœ‰æ•ˆæœŸä¸å®œè¿‡é•¿ï¼Œæ¯”å¦‚ç¼©çŸ­åˆ°ä¸€å¹´æˆ–ä¸¤å¹´ï¼Œä»¥æé«˜å®‰å…¨æ€§ã€‚
> ç”¨æˆ·å¯èƒ½éœ€è¦ç†è§£æ¯ä¸ªæ­¥éª¤çš„æ„ä¹‰ï¼Œç‰¹åˆ«æ˜¯åœ¨è‡ªç­¾åè¯ä¹¦æˆ–å†…éƒ¨CAçš„æƒ…å†µä¸‹ï¼Œæ­£ç¡®é…ç½®æ‰©å±•éƒ¨åˆ†ï¼ˆå¦‚SANï¼‰å¯¹äºé¿å…æµè§ˆå™¨è­¦å‘Šéå¸¸å…³é”®ã€‚æ­¤å¤–ï¼Œå¦‚æœCAçš„ç§é’¥æ²¡æœ‰æ­£ç¡®è®¾ç½®æƒé™ï¼Œå¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é—®é¢˜ã€‚
> æ€»ç»“æ¥è¯´ï¼Œè¿™ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯ä½¿ç”¨æŒ‡å®šçš„CAè¯ä¹¦å’Œç§é’¥å¯¹ä¸€ä¸ªCSRè¿›è¡Œç­¾åï¼Œç”Ÿæˆæœ‰æ•ˆæœŸä¸º10å¹´çš„æœåŠ¡å™¨è¯ä¹¦ï¼Œå¹¶åº”ç”¨äº†æ¥è‡ªsan.cnfæ–‡ä»¶çš„æ‰©å±•é…ç½®ï¼Œç‰¹åˆ«æ˜¯ä¸v3_reqç›¸å…³çš„è®¾ç½®ã€‚ç”¨æˆ·éœ€è¦ç¡®ä¿æ‰€æœ‰æ–‡ä»¶è·¯å¾„æ­£ç¡®ï¼Œæ‰©å±•é…ç½®æ­£ç¡®æ— è¯¯ï¼Œå¹¶ä¸”CAè¯ä¹¦å’Œç§é’¥æœ‰æ•ˆä¸”å®‰å…¨ã€‚
> 

ä»¥ä¸‹æ˜¯å¯¹è¯¥ OpenSSL å‘½ä»¤çš„é€å±‚è§£æï¼š

```bash
openssl x509 \
  -req \                  # æŒ‡å®šè¾“å…¥ä¸º CSR æ–‡ä»¶
  -days 3650 \            # è¯ä¹¦æœ‰æ•ˆæœŸï¼ˆ10å¹´ï¼‰
  -in $CERT_DIR/server.csr \  # è¾“å…¥ CSR æ–‡ä»¶è·¯å¾„
  -CA $CERT_DIR/ca.crt \      # CA è¯ä¹¦æ–‡ä»¶
  -CAkey $CERT_DIR/ca.key \   # CA ç§é’¥æ–‡ä»¶
  -CAcreateserial \       # è‡ªåŠ¨ç”Ÿæˆåºåˆ—å·æ–‡ä»¶
  -extfile $TOOLS_DIR/san.cnf \  # æ‰©å±•é…ç½®æ–‡ä»¶
  -extensions v3_req \    # ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­ [v3_req] æ®µè½
  -out $CERT_DIR/server.crt  # è¾“å‡ºç­¾å‘çš„è¯ä¹¦æ–‡ä»¶
```

---

### **å…³é”®å‚æ•°æ·±åº¦è§£æ**

#### **1. è¯ä¹¦ç”Ÿæˆæµç¨‹**
```text
           CSR æ–‡ä»¶
             â”‚
             â–¼
CA ç§é’¥ç­¾å â†’â”‚â† CA è¯ä¹¦
             â”‚
             â–¼
        æœ€ç»ˆè¯ä¹¦ (.crt)
```

#### **2. æœ‰æ•ˆæœŸé…ç½® (-days 3650)**
- å…¸å‹å€¼å¯¹æ¯”ï¼š
  ```text
  æµ‹è¯•ç¯å¢ƒ  | ç”Ÿäº§ç¯å¢ƒ
  ---------|---------
  365å¤©    | 825å¤©ï¼ˆ2å¹´+ï¼‰
  ```
- å®‰å…¨å»ºè®®ï¼šè¶…è¿‡ 2 å¹´çš„è¯ä¹¦ä¼šè¢«ç°ä»£æµè§ˆå™¨æ ‡è®°ä¸ºä¸å®‰å…¨

#### **3. æ‰©å±•æ–‡ä»¶ (-extfile) ç¤ºä¾‹**
```ini
# san.cnf æ–‡ä»¶å†…å®¹
[v3_req]
keyUsage = critical,digitalSignature,keyEncipherment
extendedKeyUsage = serverAuth
subjectAltName = @alt_names

[alt_names]
DNS.1 = example.com
DNS.2 = www.example.com
IP.1 = 192.168.1.100
```

---

### **å®‰å…¨å¢å¼ºå»ºè®®**
```bash
# æ·»åŠ å¯†é’¥å¼ºåŒ–å‚æ•°
openssl x509 -req ... \
  -sigopt rsa_padding_mode:pss \  # RSA-PSS å¡«å……
  -sigopt rsa_pss_saltlen:32      # ç›å€¼é•¿åº¦
```

---

### **å„æ–‡ä»¶ä½œç”¨è¯´æ˜**
| æ–‡ä»¶                  | ç±»å‹        | æ•æ„Ÿç­‰çº§ | å…¸å‹æƒé™       |
|----------------------|------------|--------|--------------|
| ca.key               | ç§é’¥        | â˜…â˜…â˜…â˜…â˜…  | 600ï¼ˆä»…å±ä¸»è¯»ï¼‰ |
| ca.crt               | è¯ä¹¦        | â˜…â˜…â˜†â˜†â˜†  | 644          |
| server.csr           | ç­¾åè¯·æ±‚     | â˜…â˜…â˜†â˜†â˜†  | 644          |
| san.cnf              | é…ç½®æ–‡ä»¶     | â˜…â˜†â˜†â˜†â˜†  | 644          |
| server.crt           | æœ€ç»ˆè¯ä¹¦     | â˜…â˜…â˜†â˜†â˜†  | 644          |

---

### **ç­¾å‘è¿‡ç¨‹ç›‘æ§**
```bash
# æŸ¥çœ‹è¯ä¹¦è¯¦ç»†ä¿¡æ¯
openssl x509 -in server.crt -text -noout

# éªŒè¯è¯ä¹¦é“¾å®Œæ•´æ€§
openssl verify -CAfile ca.crt server.crt

# æ£€æŸ¥ SAN ä¿¡æ¯
openssl x509 -in server.crt -ext subjectAltName -noout
```

---

### **ä¼ä¸šçº§æœ€ä½³å®è·µ**
1. **å¯†é’¥è½®æ¢æœºåˆ¶**  
   é€šè¿‡ `-CAcreateserial` ç”Ÿæˆçš„ `.srl` æ–‡ä»¶è®°å½•åºåˆ—å·ï¼Œéœ€å®šæœŸå½’æ¡£

2. **OCSP è£…è®¢é…ç½®**  
   åœ¨æ‰©å±•æ–‡ä»¶ä¸­æ·»åŠ ï¼š
   ```ini
   authorityInfoAccess = OCSP;URI:http://ocsp.example.com
   ```

3. **CRL åˆ†å‘ç‚¹**  
   ```ini
   crlDistributionPoints = URI:http://crl.example.com/root.crl
   ```

é€šè¿‡è¯¥æ–¹æ¡ˆç­¾å‘çš„è¯ä¹¦å¯æ»¡è¶³ PCI DSS å’Œç­‰ä¿ä¸‰çº§è¦æ±‚ï¼Œå»ºè®®é…åˆè‡ªåŠ¨åŒ–ç­¾å‘ç³»ç»Ÿï¼ˆå¦‚ Vault PKIï¼‰ä½¿ç”¨ã€‚