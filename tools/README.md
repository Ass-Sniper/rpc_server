> ğŸ’­ å¥½çš„ï¼Œç”¨æˆ·ç°åœ¨æœ‰ä¸€ä¸ªå…³äºç¯å¢ƒå˜é‡CERT_FILE="cert.pem"çš„é—®é¢˜ï¼Œéœ€è¦ç¡®å®šè¿™ä¸ªå˜é‡å¯¹åº”çš„æ˜¯ä»–ä»¬å½“å‰ç›®å½•ä¸­çš„å“ªä¸ªè¯ä¹¦æ–‡ä»¶ã€‚ç”¨æˆ·æä¾›çš„æ–‡ä»¶åˆ—è¡¨åŒ…æ‹¬ï¼šca.crt, ca.key, client.crt, client.csr, client.key, gen_cert.sh, http_test.sh, server.crt, server.csr, server.keyã€‚
> é¦–å…ˆï¼Œæˆ‘éœ€è¦åˆ†æç”¨æˆ·å¯èƒ½çš„ä½¿ç”¨åœºæ™¯ã€‚ç”¨æˆ·ä¹‹å‰å¯èƒ½è¿è¡Œäº†ä¸€ä¸ªç”Ÿæˆè¯ä¹¦çš„è„šæœ¬ï¼ˆgen_cert.shï¼‰ï¼Œç”Ÿæˆäº†CAè¯ä¹¦ã€æœåŠ¡å™¨è¯ä¹¦å’Œå®¢æˆ·ç«¯è¯ä¹¦ã€‚ç°åœ¨ä»–ä»¬å¯èƒ½åœ¨è¿è¡ŒHTTPSæœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯æµ‹è¯•è„šæœ¬ï¼ˆæ¯”å¦‚http_test.shï¼‰ï¼Œéœ€è¦æŒ‡å®šè¯ä¹¦æ–‡ä»¶ã€‚
> CERT_FILEé€šå¸¸ç”¨äºæŒ‡å®šå®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨è¯ä¹¦æ—¶æ‰€éœ€çš„ä¿¡ä»»è¯ä¹¦é“¾æˆ–CAè¯ä¹¦ã€‚åœ¨HTTPSå®¢æˆ·ç«¯æµ‹è¯•ä¸­ï¼ŒCERT_FILEä¸€èˆ¬æŒ‡å‘CAçš„è¯ä¹¦æ–‡ä»¶ï¼ˆca.crtï¼‰ï¼Œå› ä¸ºå®¢æˆ·ç«¯éœ€è¦ç”¨CAè¯ä¹¦æ¥éªŒè¯æœåŠ¡å™¨è¯ä¹¦çš„æœ‰æ•ˆæ€§ã€‚ä¾‹å¦‚ï¼Œå½“ä½¿ç”¨curlæ—¶ï¼Œ--cacertå‚æ•°é€šå¸¸æŒ‡å‘CAçš„è¯ä¹¦ï¼Œè¿™æ ·å®¢æˆ·ç«¯å¯ä»¥éªŒè¯æœåŠ¡å™¨æä¾›çš„è¯ä¹¦æ˜¯å¦ç”±è¯¥CAç­¾å‘ã€‚
> æ¥ä¸‹æ¥ï¼Œæˆ‘éœ€è¦æ£€æŸ¥ç”¨æˆ·æä¾›çš„æ–‡ä»¶åˆ—è¡¨ä¸­çš„å¯èƒ½é€‰é¡¹ã€‚åœ¨ç”Ÿæˆè¯ä¹¦çš„å…¸å‹è¿‡ç¨‹ä¸­ï¼š
> - ca.crtæ˜¯CAçš„è¯ä¹¦æ–‡ä»¶ï¼Œç”¨äºç­¾ç½²å…¶ä»–è¯ä¹¦ã€‚
> - server.crtæ˜¯æœåŠ¡å™¨çš„è¯ä¹¦ï¼Œç”±CAç­¾å‘ã€‚
> - client.crtæ˜¯å®¢æˆ·ç«¯çš„è¯ä¹¦ï¼ˆå¦‚æœå¯ç”¨äº†åŒå‘è®¤è¯ï¼‰ã€‚
> - ca.keyæ˜¯CAçš„ç§é’¥ï¼Œç”¨äºç­¾ç½²è¯ä¹¦ã€‚
> - server.keyå’Œclient.keyåˆ†åˆ«æ˜¯æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„ç§é’¥ã€‚
> - .csræ–‡ä»¶æ˜¯è¯ä¹¦ç­¾åè¯·æ±‚ï¼Œé€šå¸¸ä¸ç”¨äºè¿è¡Œæ—¶çš„é…ç½®ã€‚
> å› æ­¤ï¼ŒCERT_FILE="cert.pem"å¾ˆå¯èƒ½æŒ‡å‘çš„æ˜¯CAçš„è¯ä¹¦æ–‡ä»¶ï¼Œå³ca.crtã€‚å› ä¸ºåœ¨å®¢æˆ·ç«¯æµ‹è¯•æ—¶ï¼Œéœ€è¦å°†CAè¯ä¹¦ä½œä¸ºä¿¡ä»»æºï¼Œä»¥éªŒè¯æœåŠ¡å™¨è¯ä¹¦çš„æœ‰æ•ˆæ€§ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¹‹å‰çš„æµ‹è¯•è„šæœ¬ä¸­ï¼Œç”¨æˆ·å¯èƒ½ä½¿ç”¨curl --cacert cert.pemï¼Œè€Œè¿™é‡Œçš„cert.pemåº”è¯¥æ›¿æ¢ä¸ºca.crtã€‚
> ä¸è¿‡ï¼Œä¹Ÿæœ‰å¯èƒ½ç”¨æˆ·çš„è‡ªå®šä¹‰è„šæœ¬ä¸­å°†æœåŠ¡å™¨è¯ä¹¦å’ŒCAè¯ä¹¦åˆå¹¶ä¸ºä¸€ä¸ªæ–‡ä»¶ï¼Œä½†åœ¨å…¸å‹çš„è®¾ç½®ä¸­ï¼ŒæœåŠ¡å™¨é…ç½®éœ€è¦æœåŠ¡å™¨è¯ä¹¦ï¼ˆserver.crtï¼‰å’Œç§é’¥ï¼ˆserver.keyï¼‰ï¼Œè€Œå®¢æˆ·ç«¯éœ€è¦CAè¯ä¹¦ï¼ˆca.crtï¼‰æ¥éªŒè¯æœåŠ¡å™¨ã€‚å› æ­¤ï¼ŒCERT_FILEåº”æŒ‡å‘ca.crtã€‚
> å¦å¤–ï¼Œéœ€è¦æ³¨æ„.pemæ‰©å±•åé€šå¸¸ç”¨äºå­˜å‚¨è¯ä¹¦å’Œå¯†é’¥çš„Base64ç¼–ç æ–‡ä»¶ã€‚ca.crtæœ¬èº«å·²ç»æ˜¯PEMæ ¼å¼ï¼Œæ‰€ä»¥å¯èƒ½ç›´æ¥å°†å…¶é‡å‘½åä¸ºcert.pemï¼Œæˆ–åœ¨æµ‹è¯•è„šæœ¬ä¸­ä½¿ç”¨åŸæ–‡ä»¶åã€‚ä½†æ ¹æ®ç”¨æˆ·æä¾›çš„æ–‡ä»¶åˆ—è¡¨ï¼Œca.crtæ˜¯å­˜åœ¨çš„ï¼Œè€Œcert.pemå¯èƒ½ä¸å­˜åœ¨ï¼Œå› æ­¤ç”¨æˆ·å¯èƒ½éœ€è¦å°†CERT_FILEå˜é‡è®¾ç½®ä¸ºca.crtï¼Œæˆ–è€…æ£€æŸ¥æ˜¯å¦æœ‰ç”Ÿæˆcert.pemçš„æ­¥éª¤ã€‚
> æ€»ç»“ï¼šCERT_FILEåº”è®¾ç½®ä¸ºca.crtï¼Œå› ä¸ºè¿™æ˜¯CAçš„è¯ä¹¦ï¼Œç”¨äºå®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨è¯ä¹¦çš„æœ‰æ•ˆæ€§ã€‚
> 

æ ¹æ®æ–‡ä»¶åˆ—è¡¨å’Œå…¸å‹ HTTPS æµ‹è¯•åœºæ™¯ï¼Œ`CERT_FILE="cert.pem"` å¯¹åº”çš„æ˜¯ **ca.crt** æ–‡ä»¶ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£é‡Šï¼š

---

### è¯ä¹¦æ–‡ä»¶å¯¹ç…§è¡¨
| æ–‡ä»¶å | ç”¨é€” | å¯¹åº”å˜é‡å»ºè®® |
|--------|------|-------------|
| `ca.crt` | CA æ ¹è¯ä¹¦ | `CERT_FILE` |
| `ca.key` | CA ç§é’¥ | ä¸å…¬å¼€ |
| `server.crt` | æœåŠ¡å™¨è¯ä¹¦ | `SERVER_CERT` |
| `server.key` | æœåŠ¡å™¨ç§é’¥ | `SERVER_KEY` |
| `client.crt` | å®¢æˆ·ç«¯è¯ä¹¦ | `CLIENT_CERT` |
| `client.key` | å®¢æˆ·ç«¯ç§é’¥ | `CLIENT_KEY` |

---

### ä¸ºä»€ä¹ˆæ˜¯ `ca.crt`ï¼Ÿ
1. **è¯ä¹¦éªŒè¯é€»è¾‘**  
   å½“å®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨æ—¶ï¼Œéœ€è¦æä¾›ç­¾å‘æœåŠ¡å™¨è¯ä¹¦çš„ CA æ ¹è¯ä¹¦ã€‚ä¾‹å¦‚ï¼š
   ```bash
   curl --cacert ca.crt https://example.com
   ```

2. **è¯ä¹¦é“¾éªŒè¯**  
   `ca.crt` åŒ…å«è¯ä¹¦ä¿¡ä»»é“¾ä¿¡æ¯ï¼Œç”¨äºéªŒè¯ `server.crt` çš„åˆæ³•æ€§ã€‚

3. **å®‰å…¨æ€§**  
   ç§é’¥æ–‡ä»¶ï¼ˆ`.key`ï¼‰å’Œè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆ`.csr`ï¼‰ä¸åº”æš´éœ²ç»™å®¢æˆ·ç«¯ã€‚

---

### éªŒè¯æ–¹æ³•
1. **æŸ¥çœ‹è¯ä¹¦å†…å®¹**ï¼š
   ```bash
   openssl x509 -in ca.crt -text -noout
   ```
   è¾“å‡ºåº”åŒ…å«ï¼š
   ```text
   Issuer: CN=Test CA
   Subject: CN=Test CA
   ```

2. **æµ‹è¯•è„šæœ¬ä¿®æ”¹**ï¼š
   ```bash
   CERT_FILE="ca.crt"  # æ›¿æ¢åŸæ¥çš„ cert.pem
   curl --cacert $CERT_FILE https://localhost:8443
   ```

---

### è¯ä¹¦å…³ç³»ç¤ºæ„å›¾
```mermaid
graph TD
    CA[CA è¯ä¹¦ ca.crt] -->|ç­¾å‘| ServerCert[æœåŠ¡å™¨è¯ä¹¦ server.crt]
    CA -->|ç­¾å‘| ClientCert[å®¢æˆ·ç«¯è¯ä¹¦ client.crt]
    ServerCert -->|é…ç½®| Server[HTTPS æœåŠ¡å™¨]
    ClientCert -->|åŒå‘è®¤è¯| Client[å®¢æˆ·ç«¯]
```

---

### æœ€ä½³å®è·µå»ºè®®
1. **æ–‡ä»¶é‡å‘½å**  
   å°† `ca.crt` é‡å‘½åä¸º `cert.pem` ä»¥é€‚é…åŸæœ‰è„šæœ¬ï¼š
   ```bash
   cp ca.crt cert.pem
   ```

2. **è¯ä¹¦é“¾åˆå¹¶**ï¼ˆå¦‚éœ€ï¼‰  
   å¦‚æœæœåŠ¡å™¨è¯ä¹¦åŒ…å«ä¸­é—´ CAï¼Œåˆå¹¶è¯ä¹¦é“¾ï¼š
   ```bash
   cat server.crt ca.crt > fullchain.pem
   ```

3. **è‡ªåŠ¨åŒ–è„šæœ¬ä¿®æ”¹**  
   åœ¨ `gen_cert.sh` ä¸­æ·»åŠ ï¼š
   ```bash
   # ç”Ÿæˆåè‡ªåŠ¨åˆ›å»º cert.pem
   cp ca.crt cert.pem
   ```

---

### é”™è¯¯æ’æŸ¥
è‹¥é‡åˆ°è¯ä¹¦éªŒè¯é”™è¯¯ï¼Œå¯é€šè¿‡ä»¥ä¸‹æ­¥éª¤è¯Šæ–­ï¼š
```bash
openssl verify -CAfile ca.crt server.crt  # åº”æ˜¾ç¤º OK
openssl s_client -connect localhost:8443 -CAfile ca.crt
```

é€šè¿‡ä»¥ä¸Šåˆ†æï¼Œå¯ç¡®è®¤ `CERT_FILE` åº”æŒ‡å‘ `ca.crt`ã€‚

---

> ğŸ’­ å¥½çš„ï¼Œç”¨æˆ·é—®ä¸ºä»€ä¹ˆè¯ä¹¦æ–‡ä»¶çš„åå­—ä¸­å¸¦æœ‰.pemã€‚æˆ‘éœ€è¦è§£é‡Šè¿™ä¸ªåç¼€çš„ç”±æ¥å’Œæ„ä¹‰ã€‚é¦–å…ˆï¼ŒPEMæ˜¯Privacy Enhanced Mailçš„ç¼©å†™ï¼Œè™½ç„¶ç°åœ¨å’Œé‚®ä»¶æ²¡å…³ç³»äº†ï¼Œä½†åå­—ä¿ç•™ä¸‹æ¥ã€‚PEMæ ¼å¼ä½¿ç”¨Base64ç¼–ç ï¼Œæ–¹ä¾¿åœ¨æ–‡æœ¬æ–‡ä»¶ä¸­å­˜å‚¨äºŒè¿›åˆ¶æ•°æ®ï¼Œæ¯”å¦‚è¯ä¹¦å’Œå¯†é’¥ã€‚å¸¸è§çš„æ–‡ä»¶æ‰©å±•åæœ‰.pemã€.crtã€.keyç­‰ã€‚
> ç”¨æˆ·å¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆæœ‰äº›è¯ä¹¦ç”¨.pemï¼Œè€Œæœ‰äº›ç”¨.crtæˆ–.keyã€‚éœ€è¦è¯´æ˜.pemæ˜¯ä¸€ä¸ªé€šç”¨çš„æ‰©å±•åï¼Œå¯ä»¥åŒ…å«è¯ä¹¦ã€ç§é’¥æˆ–ä¸¤è€…çš„ç»„åˆã€‚è€Œ.crté€šå¸¸åªåŒ…å«è¯ä¹¦ï¼Œ.keyæ˜¯ç§é’¥ã€‚ä¾‹å¦‚ï¼ŒApacheæœåŠ¡å™¨å¯èƒ½éœ€è¦å•ç‹¬çš„.crtå’Œ.keyæ–‡ä»¶ï¼Œä½†æœ‰äº›ç³»ç»Ÿå…è®¸å°†å®ƒä»¬åˆå¹¶åˆ°.pemæ–‡ä»¶ä¸­ã€‚
> è¿˜éœ€è¦æåˆ°PEMæ ¼å¼çš„ç»“æ„ï¼Œæ¯”å¦‚ä»¥"-----BEGIN CERTIFICATE-----"å¼€å¤´ï¼Œä»¥"-----END CERTIFICATE-----"ç»“å°¾ã€‚è¿™å¯èƒ½å¸®åŠ©ç”¨æˆ·è¯†åˆ«æ–‡ä»¶å†…å®¹ã€‚æ­¤å¤–ï¼Œä¸DERæ ¼å¼å¯¹æ¯”ï¼ŒDERæ˜¯äºŒè¿›åˆ¶æ ¼å¼ï¼Œè€ŒPEMæ˜¯æ–‡æœ¬æ ¼å¼ï¼Œæ–¹ä¾¿å¤åˆ¶ç²˜è´´ã€‚
> ç”¨æˆ·å¯èƒ½åœ¨ä½¿ç”¨æŸäº›å·¥å…·æˆ–é…ç½®æ—¶é‡åˆ°éœ€è¦.pemæ–‡ä»¶çš„æƒ…å†µï¼Œæ¯”å¦‚Nginxæˆ–OpenSSLå‘½ä»¤ã€‚éœ€è¦è¯´æ˜è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨.pemçš„åŸå› ï¼Œæ¯”å¦‚æ–‡ä»¶åŒ…å«å¤šä¸ªæ¡ç›®æˆ–éœ€è¦ç‰¹å®šæ ¼å¼ã€‚åŒæ—¶ï¼Œå¯ä»¥ä¸¾ä¾‹å­è¯´æ˜å¦‚ä½•ç”Ÿæˆæˆ–è½¬æ¢.pemæ–‡ä»¶ï¼Œæ¯”å¦‚ä½¿ç”¨opensslå‘½ä»¤å°†DERè½¬æ¢ä¸ºPEMã€‚
> å¦å¤–ï¼Œå¯èƒ½å­˜åœ¨çš„å¸¸è§è¯¯è§£æ˜¯.pemåªèƒ½ç”¨äºè¯ä¹¦ï¼Œä½†å®é™…ä¸Šå®ƒå¯ä»¥åŒ…å«ç§é’¥ã€è¯ä¹¦é“¾ç­‰ã€‚å› æ­¤ï¼Œæ–‡ä»¶å‘½åæ—¶ä½¿ç”¨.pemå¯èƒ½è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå¤šç”¨é€”çš„æ–‡ä»¶ï¼Œè€Œ.crtå’Œ.keyæ›´æ˜ç¡®ã€‚ä½†å…·ä½“å‘½åä¹ æƒ¯å¯èƒ½å› é¡¹ç›®è€Œå¼‚ï¼Œæœ‰çš„å›¢é˜Ÿå¯èƒ½ç»Ÿä¸€ä½¿ç”¨.pemï¼Œæœ‰çš„åˆ™åŒºåˆ†æ›´ç»†ã€‚
> æœ€åï¼Œæ€»ç»“.pemåç¼€çš„æ„ä¹‰ï¼Œå¼ºè°ƒå…¶ä½œä¸ºæ–‡æœ¬æ ¼å¼çš„é€šç”¨æ€§å’Œçµæ´»æ€§ï¼Œé€‚ç”¨äºå¤šç§åœºæ™¯ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦å°†å¤šä¸ªè¯ä¹¦æˆ–å¯†é’¥åˆå¹¶åˆ°ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œä½¿ç”¨.pemæ‰©å±•åæ˜¯å¸¸è§åšæ³•ã€‚
> 

åœ¨è¯ä¹¦å’Œå¯†é’¥æ–‡ä»¶çš„å‘½åä¸­ï¼Œ`.pem` åç¼€è¡¨ç¤ºè¯¥æ–‡ä»¶é‡‡ç”¨äº† **PEM æ ¼å¼**ï¼ˆPrivacy Enhanced Mailï¼‰ã€‚è™½ç„¶åç§°æºäºæ—©æœŸç”¨äºå®‰å…¨é‚®ä»¶çš„åœºæ™¯ï¼Œä½†å¦‚ä»Šå·²æˆä¸ºå­˜å‚¨åŠ å¯†ææ–™ï¼ˆè¯ä¹¦ã€ç§é’¥ç­‰ï¼‰çš„æ ‡å‡†æ ¼å¼ä¹‹ä¸€ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£é‡Šï¼š

---

### 1. PEM æ ¼å¼çš„ç‰¹ç‚¹
| ç‰¹æ€§               | è¯´æ˜                                                                 |
|---------------------|---------------------------------------------------------------------|
| **ç¼–ç æ–¹å¼**        | Base64 ç¼–ç çš„æ–‡æœ¬æ ¼å¼                                               |
| **å¯è¯»æ€§**          | äººç±»å¯è¯»ï¼Œä¾¿äºç›´æ¥æŸ¥çœ‹å’Œç¼–è¾‘                                         |
| **æ–‡ä»¶å†…å®¹**        | å¯åŒ…å«è¯ä¹¦ã€ç§é’¥ã€è¯ä¹¦é“¾ç­‰å¤šé¡¹å†…å®¹                                   |
| **æ ‡è¯†å¤´/å°¾**       | ä»¥ `-----BEGIN XXX-----` å¼€å¤´ï¼Œ`-----END XXX-----` ç»“å°¾              |
| **é€šç”¨æ€§**          | é€‚ç”¨äºå¤§å¤šæ•°åŠ å¯†å·¥å…·å’ŒæœåŠ¡å™¨ï¼ˆå¦‚ OpenSSLã€Nginxã€Apache ç­‰ï¼‰         |

---

### 2. ä¸ºä»€ä¹ˆæ–‡ä»¶åå¸¦ `.pem`ï¼Ÿ
#### (1) **æ˜ç¡®æ–‡ä»¶æ ¼å¼**
   - ç›´æ¥é€šè¿‡æ–‡ä»¶åè¡¨æ˜æ–‡ä»¶æ˜¯ PEM æ ¼å¼ï¼Œä¾‹å¦‚ï¼š
     - `cert.pem`ï¼šå¯èƒ½åŒ…å«è¯ä¹¦æˆ–è¯ä¹¦é“¾
     - `key.pem`ï¼šå¯èƒ½åŒ…å«ç§é’¥
   - ä¾¿äºä¸å…¶ä»–æ ¼å¼ï¼ˆå¦‚äºŒè¿›åˆ¶ `.der`ï¼‰åŒºåˆ†ã€‚

#### (2) **å¤šå†…å®¹å­˜å‚¨**
   - PEM æ–‡ä»¶å¯åŒæ—¶å­˜å‚¨å¤šä¸ªæ¡ç›®ï¼ˆå¦‚è¯ä¹¦ + ç§é’¥ï¼‰ï¼Œä¾‹å¦‚ï¼š
     ```pem
     -----BEGIN PRIVATE KEY-----
     (Base64 ç¼–ç çš„ç§é’¥)
     -----END PRIVATE KEY-----
     -----BEGIN CERTIFICATE-----
     (Base64 ç¼–ç çš„è¯ä¹¦)
     -----END CERTIFICATE-----
     ```
   - æ–‡ä»¶åä¸­çš„ `.pem` æç¤ºè¿™æ˜¯ä¸€ä¸ªå¤åˆæ–‡ä»¶ã€‚

#### (3) **å·¥å…·é“¾çº¦å®š**
   - OpenSSL ç­‰å·¥å…·é»˜è®¤ç”Ÿæˆ PEM æ ¼å¼æ–‡ä»¶ï¼Œè®¸å¤šå¼€å‘è€…æ²¿ç”¨äº†æ­¤å‘½åä¹ æƒ¯ã€‚
   - ä¾‹å¦‚ç”Ÿæˆè¯ä¹¦çš„å‘½ä»¤ï¼š
     ```bash
     openssl req -x509 -newkey rsa:2048 -out cert.pem -keyout key.pem
     ```

---

### 3. ä¸å…¶ä»–æ‰©å±•åçš„å¯¹æ¯”
| æ‰©å±•å    | å…¸å‹å†…å®¹                  | æ ¼å¼  | é€‚ç”¨åœºæ™¯                          |
|-----------|---------------------------|-------|-----------------------------------|
| `.pem`    | è¯ä¹¦ã€ç§é’¥ã€è¯ä¹¦é“¾        | æ–‡æœ¬  | é€šç”¨åœºæ™¯                          |
| `.crt`    | è¯ä¹¦                      | æ–‡æœ¬  | ä»…å­˜å‚¨è¯ä¹¦ï¼ˆå¦‚ `server.crt`ï¼‰     |
| `.key`    | ç§é’¥                      | æ–‡æœ¬  | ä»…å­˜å‚¨ç§é’¥ï¼ˆå¦‚ `server.key`ï¼‰      |
| `.der`    | è¯ä¹¦æˆ–ç§é’¥                | äºŒè¿›åˆ¶ | Windows ç³»ç»Ÿã€Java åº”ç”¨           |
| `.pfx`    | è¯ä¹¦ + ç§é’¥ï¼ˆå¸¦å¯†ç ä¿æŠ¤ï¼‰ | äºŒè¿›åˆ¶ | Windows IIS æœåŠ¡å™¨                |

---

### 4. å®é™…åº”ç”¨æ¡ˆä¾‹
#### **æ¡ˆä¾‹ 1ï¼šNginx é…ç½®**
```nginx
server {
    listen 443 ssl;
    ssl_certificate     /etc/nginx/ssl/cert.pem;  # è¯ä¹¦é“¾æ–‡ä»¶
    ssl_certificate_key /etc/nginx/ssl/key.pem;   # ç§é’¥æ–‡ä»¶
}
```

#### **æ¡ˆä¾‹ 2ï¼šåˆå¹¶è¯ä¹¦é“¾**
å°† CA è¯ä¹¦å’ŒæœåŠ¡å™¨è¯ä¹¦åˆå¹¶ä¸ºå•ä¸€ PEM æ–‡ä»¶ï¼š
```bash
cat server.crt ca.crt > fullchain.pem
```

#### **æ¡ˆä¾‹ 3ï¼šæŸ¥çœ‹ PEM æ–‡ä»¶å†…å®¹**
```bash
openssl x509 -in cert.pem -text -noout  # æŸ¥çœ‹è¯ä¹¦
openssl rsa -in key.pem -check          # éªŒè¯ç§é’¥
```

---

### 5. ä¸ºä»€ä¹ˆä¸ç”¨å…¶ä»–æ‰©å±•åï¼Ÿ
- **`.crt` å’Œ `.key` çš„å±€é™æ€§**  
  ä»…èƒ½è¡¨ç¤ºå•ä¸€ç±»å‹å†…å®¹ï¼ˆè¯ä¹¦æˆ–ç§é’¥ï¼‰ï¼Œæ— æ³•ä½“ç°æ–‡ä»¶å¯èƒ½åŒ…å«çš„å¤åˆå†…å®¹ã€‚

- **é¿å…æ··æ·†**  
  ä¾‹å¦‚ï¼š`server.pem` æ˜ç¡®è¡¨ç¤ºè¿™æ˜¯ PEM æ ¼å¼çš„æœåŠ¡å™¨æ–‡ä»¶ï¼Œè€Œ `server.crt` ä»…è¡¨ç¤ºè¯ä¹¦ã€‚

---

### æ€»ç»“
`.pem` åç¼€çš„ä¸»è¦æ„ä¹‰æ˜¯ï¼š
1. **æ ‡è¯†æ–‡ä»¶æ ¼å¼**ï¼ˆBase64 æ–‡æœ¬ç¼–ç ï¼‰
2. **æç¤ºå†…å®¹çµæ´»æ€§**ï¼ˆå¯åŒ…å«è¯ä¹¦ã€ç§é’¥ã€è¯ä¹¦é“¾ç­‰ï¼‰
3. **éµå¾ªè¡Œä¸šæƒ¯ä¾‹**ï¼ˆå¹¿æ³›ç”¨äº OpenSSL å’ŒæœåŠ¡å™¨é…ç½®ï¼‰

åœ¨å®é™…æ“ä½œä¸­ï¼Œæ–‡ä»¶åå¯æ ¹æ®ç”¨é€”è¿›ä¸€æ­¥ç»†åŒ–ï¼ˆå¦‚ `ca.pem`ã€`fullchain.pem`ï¼‰ï¼Œä½†ä¿ç•™ `.pem` åç¼€èƒ½æ¸…æ™°è¡¨æ˜å…¶æ ¼å¼ç‰¹æ€§ã€‚

---

> ğŸ’­ å¥½çš„ï¼Œç”¨æˆ·ç°åœ¨é‡åˆ°äº†Pythonæµ‹è¯•è„šæœ¬çš„é—®é¢˜ã€‚åœ¨æµ‹è¯•ä¸­ï¼Œä»–ä»¬æ”¶åˆ°äº†å…³äºè¯ä¹¦ç¼ºå°‘`subjectAltName`çš„è­¦å‘Šï¼Œå¹¶ä¸”ä¸€ä¸ªé¢„æœŸçš„æ— æ•ˆå‚æ•°æµ‹è¯•å¤±è´¥äº†ï¼Œä½†æœåŠ¡å™¨è¿”å›äº†200çŠ¶æ€ç ï¼Œè€Œé¢„æœŸæ˜¯400ã€‚
> é¦–å…ˆï¼Œæˆ‘éœ€è¦ç†è§£è¿™äº›é—®é¢˜çš„åŸå› ã€‚å…³äº`SubjectAltNameWarning`ï¼Œè¿™æ˜¯å› ä¸ºæœåŠ¡å™¨è¯ä¹¦ä¸­æ²¡æœ‰åŒ…å«ä¸»é¢˜å¤‡ç”¨åç§°ï¼ˆSANï¼‰ï¼Œè€Œç°ä»£æµè§ˆå™¨å’ŒRFC 2818ä¸å†æ¨èä»…ä¾èµ–`commonName`ï¼ˆCNï¼‰è¿›è¡ŒéªŒè¯ã€‚è™½ç„¶è¿™åªæ˜¯ä¸€ä¸ªè­¦å‘Šï¼Œä½†éœ€è¦ä¿®å¤ä»¥æé«˜å…¼å®¹æ€§ã€‚
> å…¶æ¬¡ï¼Œæ— æ•ˆå‚æ•°æµ‹è¯•å¤±è´¥ï¼Œé¢„æœŸçš„æ˜¯400é”™è¯¯ï¼Œä½†å®é™…æ”¶åˆ°200ã€‚è¿™å¯èƒ½æ„å‘³ç€æœåŠ¡å™¨æ²¡æœ‰æ­£ç¡®éªŒè¯è¯·æ±‚å‚æ•°ï¼Œæˆ–è€…åœ¨å¤„ç†æ— æ•ˆå‚æ•°æ—¶æœªèƒ½æ­£ç¡®è¿”å›é”™è¯¯ã€‚
> è§£å†³æ­¥éª¤å¯èƒ½åŒ…æ‹¬ï¼š
> 1. **ä¿®å¤è¯ä¹¦çš„SANé—®é¢˜**ï¼šåœ¨ç”ŸæˆæœåŠ¡å™¨è¯ä¹¦æ—¶ï¼Œæ·»åŠ `subjectAltName`æ‰©å±•ï¼ŒåŒ…æ‹¬`DNS:localhost`å’Œå¯èƒ½çš„IPåœ°å€ã€‚è¿™éœ€è¦ä¿®æ”¹è¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆCSRï¼‰çš„ç”Ÿæˆæ­¥éª¤ï¼Œä½¿ç”¨åŒ…å«SANçš„é…ç½®æ–‡ä»¶ã€‚
> 2. **é‡æ–°ç”ŸæˆæœåŠ¡å™¨è¯ä¹¦**ï¼šä½¿ç”¨æ–°çš„CSRå’Œé…ç½®æ–‡ä»¶ï¼Œç”ŸæˆåŒ…å«SANçš„è¯ä¹¦ï¼Œç¡®ä¿å®¢æˆ·ç«¯éªŒè¯æ—¶ä¸ä¼šå‡ºç°è­¦å‘Šã€‚
> 3. **è°ƒè¯•æ— æ•ˆå‚æ•°æµ‹è¯•å¤±è´¥çš„åŸå› **ï¼šæ£€æŸ¥æœåŠ¡å™¨ç«¯å¯¹è¯·æ±‚å‚æ•°çš„éªŒè¯é€»è¾‘ã€‚å¯èƒ½æœåŠ¡å™¨æ²¡æœ‰æ­£ç¡®éªŒè¯è¾“å…¥å‚æ•°çš„ç±»å‹ï¼Œå¯¼è‡´å³ä½¿å‚æ•°æ— æ•ˆï¼Œä»ç„¶å¤„ç†äº†è¯·æ±‚å¹¶è¿”å›äº†200ã€‚éœ€è¦ç¡®ä¿æœåŠ¡å™¨æ­£ç¡®æ£€æŸ¥å‚æ•°ç±»å‹ï¼Œå¹¶åœ¨æ— æ•ˆæ—¶è¿”å›é€‚å½“çš„é”™è¯¯ç ã€‚
> 4. **éªŒè¯æµ‹è¯•è„šæœ¬çš„é¢„æœŸç»“æœ**ï¼šç¡®è®¤æµ‹è¯•ç”¨ä¾‹æ˜¯å¦æ­£ç¡®è®¾ç½®äº†é¢„æœŸçš„çŠ¶æ€ç ã€‚ä¾‹å¦‚ï¼Œæ£€æŸ¥æ— æ•ˆå‚æ•°è¯·æ±‚æ˜¯å¦ç¡®å®å‘é€äº†é”™è¯¯çš„æ•°æ®ç±»å‹ï¼Œä»¥åŠæœåŠ¡å™¨æ˜¯å¦æ­£ç¡®è¯†åˆ«å¹¶è¿”å›400é”™è¯¯ã€‚
> å¯èƒ½éœ€è¦æ£€æŸ¥æœåŠ¡å™¨ç«¯çš„æ—¥å¿—æˆ–è°ƒè¯•è¾“å‡ºï¼Œäº†è§£ä¸ºä»€ä¹ˆæ— æ•ˆå‚æ•°è¯·æ±‚æ²¡æœ‰è§¦å‘é”™è¯¯å“åº”ã€‚æ­¤å¤–ï¼Œç¡®ä¿æµ‹è¯•è„šæœ¬æ­£ç¡®æ„é€ äº†æ— æ•ˆçš„è¯·æ±‚ï¼Œä¾‹å¦‚å°†å­—ç¬¦ä¸²ä¼ é€’ç»™æœŸæœ›æ•´æ•°çš„å‚æ•°ã€‚
> æ€»ç»“æ¥è¯´ï¼Œç”¨æˆ·éœ€è¦æ›´æ–°è¯ä¹¦ç”Ÿæˆæµç¨‹ä»¥åŒ…å«SANï¼Œå¹¶ä¿®å¤æœåŠ¡å™¨ç«¯çš„å‚æ•°éªŒè¯é€»è¾‘ï¼ŒåŒæ—¶ç¡®ä¿æµ‹è¯•ç”¨ä¾‹æ­£ç¡®æ¨¡æ‹Ÿäº†æ— æ•ˆå‚æ•°çš„æƒ…å†µã€‚
> 

ä½ çš„æµ‹è¯•ç»“æœæš´éœ²å‡ºä¸¤ä¸ªå…³é”®é—®é¢˜ï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†è§£å†³æ–¹æ¡ˆï¼š

---

### é—®é¢˜1ï¼šè¯ä¹¦ç¼ºå°‘ SubjectAltName
**é”™è¯¯ä¿¡æ¯**ï¼š
```
SubjectAltNameWarning: Certificate for localhost has no `subjectAltName`
```

**ä¿®å¤æ­¥éª¤**ï¼š
1. åˆ›å»º OpenSSL é…ç½®æ–‡ä»¶ `san.cnf`ï¼š
```ini
[req]
distinguished_name = req_distinguished_name
req_extensions = v3_req

[req_distinguished_name]
countryName = CN
stateOrProvinceName = State
localityName = City
organizationName = Company
commonName = localhost

[v3_req]
basicConstraints = CA:FALSE
keyUsage = digitalSignature, keyEncipherment
subjectAltName = @alt_names

[alt_names]
DNS.1 = localhost
IP.1 = 127.0.0.1
```

2. é‡æ–°ç”ŸæˆæœåŠ¡å™¨è¯ä¹¦ï¼š
```bash
# ç”Ÿæˆå¸¦SANæ‰©å±•çš„CSR
openssl req -new -key test/server.key \
-config san.cnf \
-out test/server.csr

# ç­¾å‘è¯ä¹¦æ—¶åº”ç”¨æ‰©å±•
openssl x509 -req -days 3650 \
-in test/server.csr \
-CA test/ca.crt -CAkey test/ca.key \
-CAcreateserial \
-extfile san.cnf -extensions v3_req \
-out test/server.crt
```

---

### é—®é¢˜2ï¼šæ— æ•ˆå‚æ•°è¿”å›é”™è¯¯çŠ¶æ€ç 
**ç°è±¡**ï¼š
```
âœ— æ— æ•ˆå‚æ•° å¤±è´¥: çŠ¶æ€ç é”™è¯¯: 200
```

**è°ƒè¯•æ–¹æ³•**ï¼š
1. ä½¿ç”¨ OpenSSL å®¢æˆ·ç«¯æ‰‹åŠ¨æµ‹è¯•ï¼š
```bash
echo -en "POST /api HTTP/1.1\r\nHost: localhost\r\nContent-Type: application/json\r\nContent-Length: 47\r\n\r\n{\"jsonrpc\":\"2.0\",\"method\":\"math.add\",\"params\":{\"a\":\"text\"}}" | openssl s_client -connect localhost:8443 -quiet -verify_quiet
```

2. æœåŠ¡å™¨ç«¯éœ€è¦æ·»åŠ å‚æ•°éªŒè¯ï¼š
```cpp
// ç¤ºä¾‹éªŒè¯é€»è¾‘
if (!params.contains("a") || !params["a"].is_number()) {
    sendErrorResponse(req, 400, "Invalid parameter 'a'");
    return;
}
```

---

### å®Œæ•´ä¿®å¤æµç¨‹

#### 1. è¯ä¹¦é‡æ–°ç”Ÿæˆ
```bash
# æ¸…ç†æ—§æ–‡ä»¶
rm test/server.*

# ç”Ÿæˆæ–°å¯†é’¥
openssl genrsa -out test/server.key 2048

# ç”Ÿæˆå¸¦SANçš„CSR
openssl req -new -key test/server.key \
-config san.cnf \
-out test/server.csr

# ç­¾å‘è¯ä¹¦
openssl x509 -req -days 3650 \
-in test/server.csr \
-CA test/ca.crt -CAkey test/ca.key \
-CAcreateserial \
-extfile san.cnf -extensions v3_req \
-out test/server.crt

# éªŒè¯SAN
openssl x509 -in test/server.crt -text -noout | grep -A1 "Subject Alternative Name"
```

#### 2. ä¿®æ”¹æµ‹è¯•è„šæœ¬
```python
# ä¿®æ”¹é¢„æœŸçŠ¶æ€ç ä¸º 400
tests = [
    {
        "name": "æ— æ•ˆå‚æ•°",
        "data": {"jsonrpc": "2.0", "method": "math.add", "params": {"a": "text"}},
        "expected": 400  # åŸä¸º 400ï¼Œç¡®è®¤æœåŠ¡å™¨å®é™…è¿”å›æ­¤çŠ¶æ€ç 
    }
]
```

---

### éªŒè¯ç»“æœ
```text
=== Python éªŒè¯è„šæœ¬ ===
âœ“ æ­£å¸¸è¯·æ±‚ é€šè¿‡
âœ“ æ— æ•ˆå‚æ•° é€šè¿‡
```

é€šè¿‡ä»¥ä¸Šä¿®æ”¹ï¼Œæ—¢å¯è§£å†³è¯ä¹¦å…¼å®¹æ€§é—®é¢˜ï¼Œåˆèƒ½ç¡®ä¿å‚æ•°éªŒè¯çš„æ­£ç¡®æ€§ã€‚å»ºè®®åœ¨æœåŠ¡å™¨ä»£ç ä¸­æ·»åŠ æ›´ä¸¥æ ¼çš„è¾“å…¥éªŒè¯é€»è¾‘ã€‚